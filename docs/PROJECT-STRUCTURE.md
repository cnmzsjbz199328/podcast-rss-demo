# 项目结构说明

本文档描述了项目的目录结构和文件组织最佳实践。

## 📁 目录结构

```
podcast-rss-demo/
├── 📁 config/              # 数据库配置和迁移文件
│   ├── schema.sql         # 数据库表结构
│   └── migrate-*.sql      # 数据库迁移脚本
├── 📁 docs/                # 项目文档
│   ├── PROJECT-GUIDE.md   # 项目指南和架构说明
│   └── PROJECT-STRUCTURE.md # 项目结构说明（本文档）
├── 📁 scripts/             # 构建、部署和工具脚本
├── 📁 src/                 # 源代码
│   ├── 📁 config/         # 应用配置
│   ├── 📁 core/           # 核心业务逻辑
│   ├── 📁 handlers/       # 请求处理器
│   ├── 📁 implementations/ # 服务实现
│   ├── 📁 services/       # 服务接口和工厂
│   ├── 📁 types/          # 类型定义
│   ├── 📁 utils/          # 工具函数
│   └── 📁 workers/        # Worker相关代码
├── 📁 tests/               # 测试文件
│   ├── 📁 unit/           # 单元测试
│   ├── 📁 integration/    # 集成测试
│   └── 📁 e2e/            # 端到端测试
├── 📁 logs/                # 日志文件
├── 📁 node_modules/       # 依赖包（自动生成）
├── 📁 .wrangler/          # Wrangler缓存（自动生成）
├── .env                   # 环境变量（敏感信息）
├── .env.example           # 环境变量示例
├── .gitignore            # Git忽略文件
├── package.json           # 项目配置和脚本
├── README.md              # 项目说明
├── worker.js              # Cloudflare Worker入口文件
└── wrangler.toml          # Cloudflare配置
```

## 📋 目录职责说明

### 🔧 `config/`
存放数据库配置和迁移脚本：
- `schema.sql`: 数据库表结构定义
- `migrate-*.sql`: 数据库迁移脚本

### 📚 `docs/`
项目文档：
- 架构设计文档
- API文档
- 部署指南
- 开发规范

### 🛠️ `scripts/`
自动化脚本：
- 构建脚本
- 部署脚本
- 数据库迁移脚本
- 代码质量检查脚本

### 💻 `src/`
源代码，按功能组织：

#### `src/config/`
- 应用配置加载
- 环境变量处理
- 配置验证

#### `src/core/`
- 核心业务逻辑
- 领域模型
- 业务规则

#### `src/handlers/`
- HTTP请求处理器
- 路由处理逻辑
- 请求/响应转换

#### `src/implementations/`
- 外部服务实现
- 数据访问层
- 第三方集成

#### `src/services/`
- 服务接口定义
- 服务工厂
- 依赖注入

#### `src/types/`
- TypeScript类型定义
- 接口定义
- 数据结构

#### `src/utils/`
- 工具函数
- 辅助方法
- 通用逻辑

#### `src/workers/`
- Cloudflare Worker特定代码
- 边缘计算逻辑

### 🧪 `tests/`
测试文件，按测试类型组织：

#### `tests/unit/`
- 单元测试
- 函数级测试
- 组件测试

#### `tests/integration/`
- 集成测试
- API集成测试
- 组件间交互测试

#### `tests/e2e/`
- 端到端测试
- 用户流程测试
- 系统级测试

### 📝 `logs/`
运行时日志文件：
- 应用日志
- 错误日志
- 调试信息

## 📏 文件大小规范

### 单个文件行数限制
- **工具函数/配置**: ≤ 100行
- **服务实现**: ≤ 200行
- **业务逻辑**: ≤ 300行
- **测试文件**: ≤ 500行

### 违反规范的文件处理
1. **职责分离**: 将大文件拆分为多个小文件
2. **提取工具类**: 通用逻辑移到工具类
3. **创建子模块**: 相关功能分组到子模块

## 🚀 最佳实践

### 文件命名
- 使用 kebab-case: `user-service.js`
- 测试文件与源文件同名: `user-service.test.js`
- 工具文件使用描述性名称: `date-utils.js`

### 目录组织
- 按功能组织，而非按文件类型
- 保持目录层级清晰（最多3-4层）
- 使用一致的目录结构

### 导入导出
- 使用 ES6 模块语法
- 按类型分组导入（内置→第三方→本地）
- 避免循环依赖

### 配置管理
- 敏感信息放环境变量
- 提供配置示例文件
- 运行时验证配置完整性

## 🔧 自动化脚本

### 测试脚本
```bash
npm run test              # 运行所有测试
npm run test:unit         # 运行单元测试
npm run test:integration  # 运行集成测试
npm run test:e2e          # 运行端到端测试
npm run test:production   # 运行生产环境测试
```

### 部署脚本
```bash
npm run deploy           # 部署到生产环境
npm run deploy:verify    # 验证部署状态
npm run deploy:logs      # 查看部署日志
```

### 数据库脚本
```bash
npm run d1:create        # 创建D1数据库
npm run d1:migrate       # 执行数据库迁移
npm run d1:query         # 执行数据库查询
```

## 📝 维护指南

### 添加新功能
1. 确定功能属于哪个目录
2. 创建相应目录（如果需要）
3. 编写代码和测试
4. 更新文档

### 重构现有代码
1. 识别违反规范的文件
2. 分析职责和依赖
3. 安全重构（保持接口兼容）
4. 更新测试和文档

### 代码审查清单
- [ ] 文件大小符合规范
- [ ] 目录结构合理
- [ ] 命名规范一致
- [ ] 测试覆盖完整
- [ ] 文档更新及时

---

## 🎯 质量保证

本项目结构遵循以下质量标准：

- **可维护性**: 清晰的目录结构和职责分离
- **可扩展性**: 模块化设计支持功能扩展
- **可测试性**: 明确的测试类型和目录组织
- **开发效率**: 标准化的脚本和工具链

通过遵循这些规范，项目能够保持长期的可维护性和开发效率。
